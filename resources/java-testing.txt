import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';

@Injectable({ providedIn: 'root' })
export class AnalyticalReportService {

  private reportIdSubject = new BehaviorSubject<number | null>(null);

  reportId$ = this.reportIdSubject.asObservable();

  openExistingReport(reportId: number): void {
    this.reportIdSubject.next(reportId);
  }

  openNewReport(): void {
    this.reportIdSubject.next(null);
  }
}


export class AnalyticsComponent implements OnInit, OnDestroy {

  reportId: number | null = null;
  private destroy$ = new Subject<void>();

  constructor(
    private analyticalReportService: AnalyticalReportService
  ) {}

  ngOnInit(): void {
    this.analyticalReportService.reportId$
      .pipe(takeUntil(this.destroy$))
      .subscribe(reportId => {
        this.reportId = reportId;

        if (reportId === null) {
          this.openNewReportUI();
        } else {
          this.loadReport();
        }
      });
  }

  ngOnDestroy(): void {
    this.destroy$.next();
    this.destroy$.complete();
  }

  private openNewReportUI(): void {
    this.reportDetails = {
      reportId: null,
      reportName: 'New Analytical Report',
      reportType: this.reportType,
      reportDetails: {},
      isEnabled: 'Y',
      isSharedReport: 'N',
      sharedUserDetails: []
    };

    this.clearGrid();
    this.clearSelections();
    this.clearAdditionalPayloads();

    this.dataLoaded = true;
  }



