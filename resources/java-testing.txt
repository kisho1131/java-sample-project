ngOnInit(): void {
  this.analyticalReportService.currentReportId$.pipe(
    takeUntil(this.destroying$),
    // switchMap handles the ID change and fetches metadata in order
    switchMap(id => {
      this.reportId = id;
      console.log('State Change Detected: New ID is', id);

      // Fetch column mappings and groupings first
      return forkJoin({
        cols: makeHttpGetRequest(this.httpClient, './api/report/column-mapping', {
          params: { reportType: this.reportType }
        }),
        groupings: makeHttpGetRequest(this.httpClient, './api/report/grouping-attr', {
          params: { reportType: this.reportType }
        })
      });
    })
  ).subscribe({
    next: (response: any) => {
      // 1. Set the Grid Structure
      this.pivotGroupColDefs = this.gridHelperService.getColModelByReportType(
        response.groupings,
        response.cols
      );

      // 2. Trigger data loading now that structure is ready
      this.loadReport();
    },
    error: (err) => console.error(err)
  });
}

---------

import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';

@Injectable({ providedIn: 'root' })
export class CommonService {
  // Use BehaviorSubject to hold the "Current" DMID state
  private dmidSource = new BehaviorSubject<any>(null);

  // Observable that components will subscribe to
  dmidState$ = this.dmidSource.asObservable();

  // Method to update the DMID from AppComponent
  updateDMID(newId: any) {
    this.dmidSource.next(newId);
  }
}

// Inside your DMID change logic
this.commonService.updateDMID(newSelectedId);

ngOnInit() {
  this.commonService.dmidState$
    .pipe(takeUntil(this.destroying$))
    .subscribe(id => {
      if (id) {
        console.log('DMID Change Detected:', id);
        this.reportId = id; //
        this.loadReport();  // Re-trigger the data fetch
      }
    });
}


ngOnInit() {
  this.commonService.dmidState$
    .pipe(takeUntil(this.destroying$))
    .subscribe(newId => {
      if (newId) {
        this.reportId = newId; //

        // Update the TMID/DMID inside the additional parameters array
        this.updatePayloadParams(newId);

        // Reload the report with the new parameters
        this.loadReport(); //
      }
    });
}

private updatePayloadParams(newId: any) {
  if (this.additionalRequestPayloadParams && this.additionalRequestPayloadParams.length > 0) {
    // We create a new array reference to ensure Angular detection triggers
    this.additionalRequestPayloadParams = this.additionalRequestPayloadParams.map(param => {
      // Check for your specific key (e.g., 'tmid', 'dmid', or 'id')
      if (param.key === 'tmid' || param.key === 'dmid') {
        return { ...param, value: newId };
      }
      return param;
    });

    console.log('Updated Additional Parameters:', this.additionalRequestPayloadParams);
  }
}

private updatePayloadParams(newId: any) {
  if (this.additionalRequestPayloadParams && this.additionalRequestPayloadParams.length > 0) {
    // Creating a new array reference to trigger Angular's change detection
    this.additionalRequestPayloadParams = this.additionalRequestPayloadParams.map(item => {
      // Check if the property 'tmId' exists in this object
      if (item.hasOwnProperty('tmId')) {
        console.log('Found tmId property, updating to:', newId);
        return { ...item, tmId: newId }; // Update the property directly
      }
      return item;
    });

    console.log('Successfully updated params:', this.additionalRequestPayloadParams);
  }
}